---
title: "Code Poetry RACING NUMBERS を紐解く"
emoji: "🏎️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["shell"]
published: false
---

インターネットの海を泳いでいたとき、こんな画像が転がっておりました。

![code-poetry](https://storage.googleapis.com/zenn-user-upload/56aecea81c46-20220515.png)

```shell
#!/bin/bash

_..() { .._  ${@//[tt]?[^s]/2};}
__.() { echo -ne $@' '        ;}
one() { __.  '1' && _.. $@    ;}
and() { __.  '&' && _.. $@    ;}
two() { __.  '2' && _.. $@    ;}
.__() { echo -ne $@\\n        ;}
.._() { .__  ${@//[ow]?[^s]/1};}
```

なんでも [Code Poetry](https://en.wikipedia.org/wiki/Code_poetry) という実行可能な詩であるとのこと。

本記事では、これを読み解いてみます。


# 自力で鑑賞してみたい

せっかくの詩なので、筆者があーだこーだ言う前に、自力で鑑賞する方法をおいておきます。

とりあえず、bashが動かせる環境を用意してください。
文法に bash の方言が盛り込まれています。

## Mac / Linux ユーザー

一番ラクなのは Linux / Mac を用意することです。
USBからブートしたり、VPS を借りたりするのも手ですね！

お手元の bash でこのスクリプトを実行したり、
書き換えてみたりして遊んでみてください。

## Windows ユーザー

Linux が用意できない場合は、WSL2 を使うといいかもしれません。

あとは Mac / Linux ユーザーの操作と同様です！

<br><br><br><br><br><br><br><br>

(以下ネタバレ、気にしない人はスクロール)

<br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br>


# 用語集

`bash` や CLI に親しくない人でもわかるように、記事の前提となる知識を書いていきますね！

:::details 長いのでおりたたみ

## シェル (プログラム)

OSを操作する際のインタフェースを提供するアプリケーションの総称です。

ターミナルを起動すると出てくる、コマンドを打つための黒い画面を提供したり、シェルスクリプトのインタプリタとして動作したりします。とりわけ、他のプログラムの実行がしやすいものになっています。

UNIX の `sh` や `bash` 、`zsh` 、`fish` のほか、
Windows の `cmd.exe` や PowerShell (`posh`) なんかもシェルと呼べるでしょう。

シェルは、それぞれ操作方法、文法に差があります。
したがって、 `bash` のスクリプトは `bash` をインタプリタにすると動くけれども、 `posh` では動かない、といったようなことが起きます。

## bash

`sh` (というよりも POSIX シェル)と互換性を持ち、さらに拡張されたシェルです。
UNIX の流れを汲む OS で使われているシェルのひとつです。

なお、バージョンごとに非互換な挙動があるので、使っているOSに載っている bash によっては動作が異なる可能性があります。

## シェルスクリプト

シェルをインタプリタとする、シェルの構文で書かれたスクリプトです。

黒い画面のインタラクティブなシェルと同様、他のプログラムを手軽に実行できる性格を備えています。

とくに POSIX という IEEE の仕様に準拠した OS には POSIX コマンド( `cd` や `echo` 、 `awk` 、 `grep` 、...)をはじめとする便利なプログラムが備わっており、シェルスクリプト内ではこれらのプログラムを利用・制御することが往々にしてあります。

## ターミナル

もともとはコンピュータにデータを入出力するためのハードウェアです。主流なのは画面とキーボードを備えた DEC の VT100 らしいです。
これをコンピュータの画面上で再現する、ターミナルエミュレータというソフトウェアもターミナルと呼びます。

設定にもよりますが、ターミナルを起動するとシェルが対話モードで実行され、いわゆる黒い画面が出現するのが一般的です。本記事でもこういう動作をするプログラムである、とします。

## Linux

Linus Torvalds らによって作られたオープンソースのOSです。
**UNIXの流れを汲み、POSIX互換でもある** OSのひとつです。

たいていのディストリビューション(派生。UbuntuやRHELなどが代表的)には GNU ライセンスの **bash がインストールされています** 。

## Mac

Apple が BSD を拡張して作ったプロプライエタリなOSです。
**UNIXの流れを汲み、POSIX互換でもある** OSのひとつです。

現状では BSD ライセンスの **bash がインストールされています** 。

## Windows

Microsoft が作ったプロプライエタリなOSです。
UNIXとは異なる流れを汲んでおり、POSIX非互換です。

そういうわけで、**Windows 上では bash や便利なプログラムたちが標準では使えません** 。

今回のように Windows で bash 向けのシェルスクリプトを実行する場合、何らかの方法で POSIX 互換環境を再現する必要があります。

近年では WSL という Windows 上で Linux を動かす仕組みが出来たため、Windows で bash や POSIX コマンドを使いたい場合は WSL で Ubuntu を導入することが近道でしょう。

:::

# 攻略

実行できる詩であるということなので、実行してみます。

そのために、まずは詩を眺めてみます。

```shell
#!/bin/bash
```

[shebang](https://ja.wikipedia.org/wiki/%E3%82%B7%E3%83%90%E3%83%B3_(Unix)) ですね。インタプリタには bash が指定されています。

そういうわけなので、以降のコードも bash 向けのシェルスクリプトであると見ていいでしょう。


## 実行してみる

というわけでシェルスクリプトを実行してみます。

簡単のために、コード全体を適当なファイル( `racing.sh` )に保存しておきます。

方法はいくつかありますが、ターミナル上でテキストエディタを起動してコードを打っていくのがわかりやすいと思います。

```
$ nano racing.sh
```

その後、ターミナルで実行権限を付与し、実行します。

```
$ chmod +x racing.sh
$ ./racing.sh
```

実行結果

```
```

……？

何も起こりません。


## なぜ何も起こらないのか

簡単のため、一部のコードを省略しました。

```shell
_..() { ... }
__.() { ... }
one() { ... }
and() { ... }
two() { ... }
.__() { ... }
.._() { ... }
```

どの行も `3文字 () {}` になっていますね。

ところで、 bash における関数の宣言の構文は以下のとおりです。

```shell
function 名前() {}
```

うち、 `function` は省略可能です。
つまり、この詩は関数を宣言する以外何もしないコード、ということになります。

## 何か実行してみる

どういった形であれ、関数である以上呼び出せそうなものです。

関数を呼び出すコードをスクリプトの末尾に追加してみます。

```shell
one
and
two
```

実行結果

```shell
1
&
2
```

数字と記号に化けました。

さらに、スクリプトの末尾を以下のようにしてみます。

```shell
one and two
```

実行結果

```shell
1 and 2
```

今度は数字と and に化けました。

見た目はただの AA なのに、一体何が起こっているのでしょうか。

## 関数の処理を追う

### one


# 結局何を言ってるのか

ここが詩の鑑賞で一番おもしろいところかと思います。
みなさんの解釈を聞かせてくださいね。

:::details 自分の解釈

**AAは何を描いたものか**

右下に「Shell」という記述があります。

```
// Shell
```

`shell script` や `bash` と書くならまだしも、
キャピタライズされた `Shell` です。

自分は、この `Shell` をプログラムのシェルとは異なる固有名詞、中でも特に、石油事業の「シェル」だと思っています。
`RACING NUMBERS` (ゼッケン)の題で Shell と言われて、レーシングカーに貼られている企業のステッカーを連想したのです。

さて、ここでメガネを外してコードをぐっと眺めると、シェルのロゴに見えてきませんか？どうでしょう……？無理ですかね……？

**one and two とは**

`Shell` な `RACING NUMBERS` についての、one and two なエピソードに思いを巡らせてみます。

シェルのロゴを貼ったレーシングカー、でしょうか。
とはいえそんなクルマは世の中にたくさんあります。

その中で自分が目をつけたのは、マクラーレン MP4/4 です。

このクルマは、1988 年の F1 で1位と2位の入賞を果たしています。

**1** 位はゼッケン **12** 番、アイルトン・セナ。
**2** 位はゼッケン **11** 番、アラン・ブロスト。

彼らの戦績は圧倒的でした。2人が所属するマクラーレン・ホンダは、16戦中15戦を獲ったのです。

F1史に残る伝説のレースを演じたチーム、そこに所属したレーサー、彼らが乗っていたクルマ。そんなMP4/4の車体にはいくつかのロゴが貼られています。ホンダ、マルボロ、グッドイヤー、そしてシェルです。

ちょうど Shell, one and two といったフレーバーがぴったり当てはまります。
偶然でしょうか。


**つまり……**

このセンセーショナルなクルマが伝説になった翌年、bashはこの世に産声を上げました。

この詩は、いにしえのギークが、流行りのbashで流行りのエピソードを書いた、そんな詩だったのではないでしょうか。

知らんけど……。

:::
